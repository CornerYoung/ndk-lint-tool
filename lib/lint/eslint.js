"use strict";var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:true});exports.check=void 0;var _objectSpread2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/objectSpread"));var _regenerator=_interopRequireDefault(require("@babel/runtime-corejs2/regenerator"));var _stringify=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/json/stringify"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator"));var _ndkUtilities=require("@nuofe/ndk-utilities");var _fs=_interopRequireDefault(require("fs"));var _path=_interopRequireDefault(require("path"));var _stripJsonComments=_interopRequireDefault(require("strip-json-comments"));var checkConfig=function(){var _ref2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(_ref){var cwd,packageInfo,rcJsPath,rcJsonPath,rcPath,eslintConfig;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cwd=_ref.cwd,packageInfo=_ref.packageInfo;rcJsPath=_path["default"].resolve(cwd,".eslintrc.js");rcJsonPath=_path["default"].resolve(cwd,".eslintrc.json");rcPath=_path["default"].resolve(cwd,".eslintrc");if(packageInfo.eslintConfig){packageInfo.__updateLint=true;eslintConfig=packageInfo.eslintConfig;delete packageInfo.eslintConfig}if(_fs["default"].existsSync(rcJsPath)){try{eslintConfig=require(rcJsPath)}catch(error){}_fs["default"].unlinkSync(rcJsPath)}if(_fs["default"].existsSync(rcJsonPath)){try{eslintConfig.push(JSON.parse((0,_stripJsonComments["default"])(_fs["default"].readFileSync(rcJsonPath,"utf8"))))}catch(error){}_fs["default"].unlinkSync(rcJsonPath)}if(_fs["default"].existsSync(rcPath)){try{eslintConfig=JSON.parse((0,_stripJsonComments["default"])(_fs["default"].readFileSync(rcPath,"utf8")))}catch(error){}}eslintConfig={root:eslintConfig.root||true,env:eslintConfig.env||{},"extends":"eslint:recommended",globals:eslintConfig.globals||undefined,parser:"babel-eslint",rules:{"comma-dangle":["error","always-multiline"],"comma-style":["error","last"],"quotes":["error","single"],"semi":["error","always"],"semi-style":["error","last"]}};_fs["default"].writeFileSync(rcPath,"".concat((0,_stringify["default"])(eslintConfig,null,4),"\n"));case 10:case"end":return _context.stop();}}},_callee)}));return function checkConfig(_x){return _ref2.apply(this,arguments)}}();var checkDependencies=function(){var _ref4=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(_ref3){var cwd,packageInfo,_packageInfo$dependen,dependencies,_packageInfo$devDepen,devDependencies;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:cwd=_ref3.cwd,packageInfo=_ref3.packageInfo;_packageInfo$dependen=packageInfo.dependencies,dependencies=_packageInfo$dependen===void 0?{}:_packageInfo$dependen,_packageInfo$devDepen=packageInfo.devDependencies,devDependencies=_packageInfo$devDepen===void 0?{}:_packageInfo$devDepen;if(dependencies["babel-eslint"]&&devDependencies["babel-eslint"]){_context2.next=5;break}_context2.next=5;return _ndkUtilities.Cmd.run({command:"yarn",args:["add","babel-eslint","--dev"],options:{cwd:cwd}});case 5:if(dependencies.eslint&&devDependencies.eslint){_context2.next=8;break}_context2.next=8;return _ndkUtilities.Cmd.run({command:"yarn",args:["add","eslint","--dev"],options:{cwd:cwd}});case 8:case"end":return _context2.stop();}}},_callee2)}));return function checkDependencies(_x2){return _ref4.apply(this,arguments)}}();var checkLint=function(){var _ref6=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(_ref5){var packageInfo,_packageInfo$scripts,scripts,_scripts$lint,lint;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:packageInfo=_ref5.packageInfo;_packageInfo$scripts=packageInfo.scripts,scripts=_packageInfo$scripts===void 0?{}:_packageInfo$scripts;_scripts$lint=scripts.lint,lint=_scripts$lint===void 0?"":_scripts$lint;if(!lint){packageInfo.__updateLint=true;packageInfo.scripts=(0,_objectSpread2["default"])({},scripts,{lint:"eslint --fix ./src/"})}case 4:case"end":return _context3.stop();}}},_callee3)}));return function checkLint(_x3){return _ref6.apply(this,arguments)}}();var check=function(){var _ref7=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(options){return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return checkConfig(options);case 2:_context4.next=4;return checkDependencies(options);case 4:_context4.next=6;return checkLint(options);case 6:case"end":return _context4.stop();}}},_callee4)}));return function check(_x4){return _ref7.apply(this,arguments)}}();exports.check=check;
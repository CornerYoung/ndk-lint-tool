"use strict";var _interopRequireWildcard=require("@babel/runtime-corejs2/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:true});exports.check=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime-corejs2/regenerator"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/objectSpread"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator"));var _stringify=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/json/stringify"));var _ndkUtilities=require("@nuofe/ndk-utilities");var _fsExtra=_interopRequireDefault(require("fs-extra"));var _path=_interopRequireDefault(require("path"));var _prettier=_interopRequireDefault(require("prettier"));var _stripJsonComments=_interopRequireDefault(require("strip-json-comments"));var Dependencies=_interopRequireWildcard(require("./dependencies"));var getRcContent=function getRcContent(name,globals){var rcContent="module.exports = {\n    extends: '".concat(name,"',\n    rules: {\n        'no-console': process.env.NODE_ENV === 'production' ? 'error' : 'off',\n        'no-debugger': process.env.NODE_ENV === 'production' ? 'error' : 'off',\n    }").concat(globals?",globals: ".concat((0,_stringify["default"])(globals,undefined,2)):"","\n};\n");return _prettier["default"].format(rcContent,{semi:true,singleQuote:true,tabWidth:4,trailingComma:"all",endOfLine:"lf",parser:"babel"})};var getRcGlobals=function getRcGlobals(rcPath){var eslintConfig;try{eslintConfig=JSON.parse((0,_stripJsonComments["default"])(_fsExtra["default"].readFileSync(rcPath,"utf8")));return eslintConfig.globals}catch(e){return}};var check=function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(options){var cwd,_options$ndkConfig,ndkConfig,packageInfo,_ndkConfig$type,type,name,rcFiles,rcJsFile,rcJsPath,rcGlobals,globals;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cwd=options.cwd,_options$ndkConfig=options.ndkConfig,ndkConfig=_options$ndkConfig===void 0?{}:_options$ndkConfig,packageInfo=options.packageInfo;_ndkConfig$type=ndkConfig.type,type=_ndkConfig$type===void 0?"":_ndkConfig$type;name=Dependencies.getName(type);rcFiles=[".eslintrc",".eslintc.json"];rcJsFile=".eslintrc.js";rcJsPath=_path["default"].resolve(cwd,rcJsFile);rcFiles.map(function(rcFile){var rcPath=_path["default"].resolve(cwd,rcFile);if(_fsExtra["default"].existsSync(rcPath)){var globals=getRcGlobals(rcPath);if(globals){rcGlobals=rcGlobals?(0,_objectSpread2["default"])({},rcGlobals,globals):(0,_objectSpread2["default"])({},globals)}_fsExtra["default"].unlinkSync(rcPath);console.log("\u5220\u9664 ".concat(rcFile," \u6587\u4EF6\u3002"))}});if(packageInfo.eslintConfig){delete packageInfo.eslintConfig;_ndkUtilities.Options.updatePackage(options);console.log("\u5220\u9664 eslintConfig \u914D\u7F6E\u3002")}if(_fsExtra["default"].existsSync(rcJsPath)){try{globals=require(rcJsPath).globals;if(globals){rcGlobals=rcGlobals?(0,_objectSpread2["default"])({},rcGlobals,globals):(0,_objectSpread2["default"])({},globals)}}catch(e){}}_fsExtra["default"].writeFileSync(rcJsPath,getRcContent(name,rcGlobals),"utf8");console.log("\u66F4\u65B0 ".concat(rcJsFile," \u6587\u4EF6\u3002"));case 11:case"end":return _context.stop();}}},_callee)}));return function check(_x){return _ref.apply(this,arguments)}}();exports.check=check;
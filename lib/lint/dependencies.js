"use strict";var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:true});exports.check=exports.getName=exports.remove=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime-corejs2/regenerator"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/objectSpread"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator"));var _keys=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/object/keys"));var _extends2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/extends"));var _ndkUtilities=require("@nuofe/ndk-utilities");var _crossSpawn=_interopRequireDefault(require("cross-spawn"));var LINT_CONFIG_MAP={app:"",web:"@nuofe/eslint-config-react",component:"",library:"",tool:""};var LINT_DEPENDENCIES={"@nuofe/eslint-config-react":"^1.0.0","babel-eslint":"^10.0.1","eslint":"^5.16.0"};var remove=function remove(_ref){var dependencies=(0,_extends2["default"])({},_ref);(0,_keys["default"])(dependencies).map(function(name){if(/eslint/.test(name)){delete dependencies[name]}});return dependencies};exports.remove=remove;var getName=function getName(type){var name=LINT_CONFIG_MAP[type];if(!name){console.log();console.log("[i] \u5F53\u524D\u5305\u7C7B\u578B\u6CA1\u6709\u53EF\u7528\u7684 lint \u5DE5\u5177\u3002");process.exit(1)}return name};exports.getName=getName;var check=function(){var _ref2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(options){var cwd,_options$ndkConfig,ndkConfig,packageInfo,_ndkConfig$type,type,name,_packageInfo$dependen,dependencies,_packageInfo$devDepen,devDependencies,showTip,_spawn$sync,status;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cwd=options.cwd,_options$ndkConfig=options.ndkConfig,ndkConfig=_options$ndkConfig===void 0?{}:_options$ndkConfig,packageInfo=options.packageInfo;_ndkConfig$type=ndkConfig.type,type=_ndkConfig$type===void 0?"":_ndkConfig$type;name=getName(type);_packageInfo$dependen=packageInfo.dependencies,dependencies=_packageInfo$dependen===void 0?{}:_packageInfo$dependen,_packageInfo$devDepen=packageInfo.devDependencies,devDependencies=_packageInfo$devDepen===void 0?{}:_packageInfo$devDepen;showTip=true;if(!devDependencies[name]){packageInfo.dependencies=remove(dependencies);packageInfo.devDependencies=(0,_objectSpread2["default"])({},remove(devDependencies),LINT_DEPENDENCIES);_ndkUtilities.Options.updatePackage(options);showTip=false;console.log();_spawn$sync=_crossSpawn["default"].sync("yarn",["add",name,"--dev"],{cwd:cwd,stdio:"inherit"}),status=_spawn$sync.status;if(status!==0){console.log();console.log("[i] \u4F9D\u8D56\u5305 ".concat(name," \u5B89\u88C5\u5931\u8D25\uFF0C\u8BF7\u7A0D\u5019\u91CD\u65B0\u6267\u884C\u547D\u4EE4\uFF01"));process.exit(1)}}if(showTip){console.log("\u4F9D\u8D56\u5305\u5DF2\u5B89\u88C5\u3002")}else{_ndkUtilities.Options.reloadPackage(options)}case 7:case"end":return _context.stop();}}},_callee)}));return function check(_x){return _ref2.apply(this,arguments)}}();exports.check=check;
"use strict";var _interopRequireWildcard=require("@babel/runtime-corejs2/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:true});exports.init=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime-corejs2/regenerator"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/objectSpread"));var _stringify=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/json/stringify"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator"));var _ndkUtilities=require("@nuofe/ndk-utilities");var _fs=_interopRequireDefault(require("fs"));var _path=_interopRequireDefault(require("path"));var _prettier=_interopRequireDefault(require("prettier"));var Config=_interopRequireWildcard(require("./config"));var init=function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var config,options,ndkConfigPath,ndkConfig,content,_args=arguments;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config=_args.length>0&&_args[0]!==undefined?_args[0]:{};_context.next=3;return _ndkUtilities.Options.init(config);case 3:options=_context.sent;ndkConfigPath=_path["default"].resolve(options.cwd,"./ndk.config.js");if(!_fs["default"].existsSync(options.packagePath)){console.log("[i] \u8BF7\u5728\u5F85\u53D1\u5E03\u5305\u6839\u76EE\u5F55\u4E0B\u6267\u884C\u6B64\u547D\u4EE4\uFF01");process.exit(1)}if(_fs["default"].existsSync(ndkConfigPath)){try{ndkConfig=require(ndkConfigPath)}catch(error){}}if(ndkConfig){_context.next=13;break}_context.next=10;return Config.init();case 10:ndkConfig=_context.sent;content=_prettier["default"].format("module.exports = ".concat((0,_stringify["default"])(ndkConfig,null,4),"\n"),{semi:true,singleQuote:true,tabWidth:4,trailingComma:"all",parser:"babel"});_fs["default"].writeFileSync(ndkConfigPath,content,"utf8");case 13:return _context.abrupt("return",(0,_objectSpread2["default"])({},options,{ndkConfig:ndkConfig,ndkConfigPath:ndkConfigPath}));case 14:case"end":return _context.stop();}}},_callee)}));return function init(){return _ref.apply(this,arguments)}}();exports.init=init;
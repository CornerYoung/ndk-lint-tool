"use strict";var _interopRequireWildcard=require("@babel/runtime-corejs2/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault");var _Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:true});exports.lint=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime-corejs2/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs2/helpers/asyncToGenerator"));var _ndkUtilities=require("@nuofe/ndk-utilities");var _crossSpawn=_interopRequireDefault(require("cross-spawn"));var Lint=_interopRequireWildcard(require("./lint"));var initOptions=function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var config,options,_args=arguments;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config=_args.length>0&&_args[0]!==undefined?_args[0]:{};_context.next=3;return _ndkUtilities.Options.init(config);case 3:options=_context.sent;if(!options.isPackageRoot){console.log("[i] \u8BF7\u5728\u5F85\u53D1\u5E03\u5305\u6839\u76EE\u5F55\u4E0B\u6267\u884C\u6B64\u547D\u4EE4\uFF01");process.exit(1)}return _context.abrupt("return",options);case 6:case"end":return _context.stop();}}},_callee)}));return function initOptions(){return _ref.apply(this,arguments)}}();var updateToLatest=function(){var _ref2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){var _require,name,version;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_require=require("../package.json"),name=_require.name,version=_require.version;_context2.next=3;return _ndkUtilities.Options.updateToLatest(name,version);case 3:case"end":return _context2.stop();}}},_callee2)}));return function updateToLatest(){return _ref2.apply(this,arguments)}}();var lint=function(){var _ref3=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(param){var config,options,cwd,_spawn$sync,status;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(param===true)){_context3.next=5;break}_context3.next=3;return updateToLatest();case 3:_context3.next=6;break;case 5:config=param;case 6:_context3.next=8;return initOptions(config);case 8:options=_context3.sent;cwd=options.cwd;_context3.next=12;return Lint.check(options);case 12:console.log();console.log("> run lint:");_spawn$sync=_crossSpawn["default"].sync("yarn",["lint"],{cwd:cwd,stdio:"inherit"}),status=_spawn$sync.status;if(status!==0){console.log();console.log("[i] \u4EE3\u7801\u68C0\u6D4B\u672A\u901A\u8FC7\uFF0C\u8BF7\u4FEE\u590D\uFF01");process.exit(1)}case 16:case"end":return _context3.stop();}}},_callee3)}));return function lint(_x){return _ref3.apply(this,arguments)}}();exports.lint=lint;